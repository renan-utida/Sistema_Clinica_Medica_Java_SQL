# Sistema de Clínica Médica

Um sistema completo para gestão de clínicas médicas desenvolvido em Java, com interface console e gráfica (Swing), integrado ao banco de dados Oracle e com teste unitário.

## 📋 Funcionalidades

- ✅ **Agendamento de Consultas** com validações de negócio
- ✅ **Cadastro de Pacientes** com validação de email
- ✅ **Cadastro de Médicos** com validação de CRM
- ✅ **Interface Dupla**: Console (Scanner) e Gráfica (Swing)
- ✅ **Integração com Oracle Database**
- ✅ **Validações de Regras de Negócio**
- ✅ **Teste Unitário com JUnit 5 e Mockito**

## 🏗️ Arquitetura

O projeto segue uma arquitetura em camadas bem definida:

```
com.example.clinic/
    ├── config/
    │   └── OracleConnectionFactory.java         # Factory de conexão Oracle
    ├── dao/
    │   └── jdbc/
    │       ├── ConsultaJdbcRepository.java      # Acesso a dados de consultas
    │       ├── MedicoDao.java                   # Acesso a dados de médicos
    │       └── PacienteDao.java                 # Acesso a dados de pacientes
    ├── domain/
    │   ├── Consulta.java                        # Entidade Consulta
    │   ├── Medico.java                          # Entidade Médico
    │   └── Paciente.java                        # Entidade Paciente
    ├── service/
    │   ├── AgendaService.java                   # Regras de agendamento
    │   ├── MedicoService.java                   # Regras de médicos
    │   └── PacienteService.java                 # Regras de pacientes
    └── ui/
        ├── console/
        │    └── ConsoleMain.java                # Classe principal com interface de Console
        └── swing/
             └── SwingMain.java                  # Classe principal com interface de Swing

test/
    └── com.example.clinic.domain.service/
        └── AgendaServiceTest.java               # Testes unitários do AgendaService
```

## 🛠️ Tecnologias Utilizadas

- **Java 17+**
- **Oracle Database** (JDBC)
- **Swing** (Interface Gráfica)
- **Scanner** (Interface Console)
- **JUnit 5** (Testes Unitários)
- **Mockito** (Mocking para testes)

## 📊 Banco de Dados

### Estrutura das Tabelas

```sql
-- Tabela de Pacientes
CREATE TABLE pacientes (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome VARCHAR2(120) NOT NULL,
  email VARCHAR2(120) NOT NULL UNIQUE
);

-- Tabela de Médicos
CREATE TABLE medicos (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome VARCHAR2(120) NOT NULL,
  crm  VARCHAR2(20) NOT NULL UNIQUE
);

-- Tabela de Consultas
CREATE TABLE consultas (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  paciente_id NUMBER NOT NULL REFERENCES pacientes(id),
  medico_id   NUMBER NOT NULL REFERENCES medicos(id),
  inicio      TIMESTAMP NOT NULL,
  fim         TIMESTAMP NOT NULL,
  CONSTRAINT chk_intervalo CHECK (fim > inicio)
);
```

### Configuração da Conexão

Configure as variáveis de ambiente ou edite `OracleConnectionFactory.java`:

```bash
ORACLE_URL=jdbc:oracle:thin:@oracle.fiap.com.br:1521:orcl
ORACLE_USER=seu_usuario
ORACLE_PASSWORD=sua_senha
```

## 🚀 Como Executar

### Pré-requisitos

1. **Java 17+** instalado
2. **Oracle Database** configurado
3. **Driver JDBC Oracle** no classpath
4. **JUnit 5** e **Mockito** para execução dos testes
5. Executar os scripts `schema.sql` e `cargaInicial.sql`

### Execução

#### Interface Console
```bash
java com.example.clinic.ui.console.ConsoleMain.java
```

#### Interface Gráfica (Swing)
```bash
java com.example.clinic.ui.swing.SwingMain.java
```

#### Execução do Teste
```bash
# Com Maven
mvn test

# Com Gradle
gradle test

# Diretamente com JUnit
java -cp "classpath:junit5:mockito" org.junit.platform.console.ConsoleLauncher --class-path=build/classes --scan-class-path
```

## 📱 Interfaces

### Menu Console
```
========================================
        SISTEMA DE CLÍNICA
========================================
1 - Agendar Consulta
2 - Cadastrar Paciente
3 - Cadastrar Médico
4 - Listar Pacientes
5 - Listar Médicos
0 - Sair
========================================
```

### Interface Swing
- **Menu Principal** com botões para cada funcionalidade
- **Telas específicas** para cada operação
- **Navegação** entre telas com CardLayout
- **Validações** em tempo real com mensagens de erro/sucesso

## ⚙️ Regras de Negócio

### Agendamento de Consultas
- ✅ **Duração mínima**: 15 minutos
- ✅ **Horário comercial**: 08:00 às 18:00
- ✅ **Antecedência mínima**: 60 minutos
- ✅ **Validação de conflitos**: Médico não pode ter consultas simultâneas

### Cadastro de Pacientes
- ✅ **Nome obrigatório**: mínimo 2, máximo 120 caracteres
- ✅ **Email válido**: formato e-mail padrão, máximo 120 caracteres
- ✅ **Normalização**: email convertido para lowercase

### Cadastro de Médicos
- ✅ **Nome obrigatório**: mínimo 2, máximo 120 caracteres
- ✅ **CRM obrigatório**: formato "CRM" + 4 a 6 dígitos (ex: CRM12345)
- ✅ **Normalização**: CRM convertido para uppercase

## 📋 Formatos de Entrada

### Data/Hora
```
Formato: dd/MM/yyyy HH:mm
Exemplo: 21/08/2025 10:30
```

### CRM
```
Formato: CRM + 4-6 dígitos
Exemplos: CRM1234, CRM123456
```

### Email
```
Formato: padrão RFC
Exemplo: paciente@email.com
```

## 🔧 Scripts SQL Incluídos

### `schema.sql`
- Criação das tabelas
- Definição de constraints
- Criação de índices

### `cargaInicial.sql`
- Dados de exemplo para testes
- 5 pacientes pré-cadastrados
- 5 médicos pré-cadastrados
- 5 consultas de exemplo

## 🧪 Testes

O projeto inclui testes unitários abrangentes para validar as regras de negócio.

### Classe AgendaServiceTest
- **Localização**: `test/com.example.clinic.domain.service/AgendaServiceTest.java`
- **Framework**: JUnit 5 com Mockito
- **Cobertura**: Validações de agendamento de consultas

#### Cenários Testados:
1. **`deveAgendarConsultaComRegrasValidas()`**
   - Testa agendamento válido com todas as regras atendidas
   - Verifica se retorna ID da consulta criada

2. **`naoDeveAgendarComConflitoDeHorario()`**
   - Testa validação de conflitos de horário
   - Verifica se lança `IllegalStateException` quando médico já tem consulta no horário

3. **`naoDeveAgendarSemAntecedenciaMinima()`**
   - Testa validação de antecedência mínima (60 minutos)
   - Verifica se lança `IllegalArgumentException` para agendamentos com menos antecedência

### Executando Testes Específicos

#### Via IDE
- Execute diretamente na IDE (IntelliJ, Eclipse, VS Code)
- Clique com botão direito em `AgendaServiceTest.java` → "Run Tests"

#### Via Linha de Comando
```bash
# Executar apenas os testes do AgendaService
java -cp "classpath" org.junit.platform.console.ConsoleLauncher --select-class=com.example.clinic.domain.service.AgendaServiceTest

# Executar teste específico
java -cp "classpath" org.junit.platform.console.ConsoleLauncher --select-method=com.example.clinic.domain.service.AgendaServiceTest#deveAgendarConsultaComRegrasValidas
```

### Testando Cadastros
1. Execute a aplicação
2. Cadastre pacientes e médicos
3. Verifique no Oracle SQL Developer:
```sql
SELECT * FROM pacientes;
SELECT * FROM medicos;
SELECT * FROM consultas;
```

### Testando Validações
- Teste CRM inválido: `123456` (deve falhar)
- Teste email inválido: `teste@` (deve falhar)
- Teste consulta fora do horário: `19:00` (deve falhar)
- Teste conflito de horário: mesmo médico, mesmo horário (deve falhar)

## 🎯 Exemplos de Uso

### Agendamento via Console
```
ID do paciente: 1
ID do médico: 1
Início da consulta (dd/MM/yyyy HH:mm): 22/08/2025 14:30
Duração em minutos: 30
```

### Cadastro de Paciente
```
Nome do paciente: João Silva
Email do paciente: joao@email.com
```

### Cadastro de Médico
```
Nome do médico: Dr. Carlos Lima
CRM do médico: CRM98765
```

## 📄 Estrutura do Projeto

```
projeto-clinica/
├── src/
│   └── com/example/clinic/
│       ├── config/
│       ├── dao.jdbc/
│       ├── domain/
│       ├── service/
│       └── ui/
│           ├── console/
│           │    └── ConsoleMain.java
│           └── swing/
│                └── SwingMain.java
├── test/
│   └── com/example/clinic/domain/service/
│       └── AgendaServiceTest.java          
├── sql/
│   ├── schema.sql
│   └── cargaInicial.sql
└── README.md

```

## 🤝 Contribuição

1. Fork o projeto
2. Crie uma branch para sua feature
3. Commit suas mudanças
4. Push para a branch
5. Abra um Pull Request

## 📝 Licença

Este projeto é desenvolvido para fins educacionais.

## 👨‍💻 Autor

**Renan Dias Utida** - RM 558540
- LinkedIn: [Renan Dias Utida](https://www.linkedin.com/in/renan-dias-utida-1b1228225/)
- GitHub: [renan-utida](https://github.com/renan-utida)

---

**💡 Dica**: Para melhor experiência, use a interface Swing que oferece uma navegação mais intuitiva entre as funcionalidades!
